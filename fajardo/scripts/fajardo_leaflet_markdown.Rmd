---
title: "fajardo_leaflet_markdown"
author: "Cindy Fajardo"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE,
                      message = FALSE,
                      fig.path = "../Output/")
```

# Libraries
```{r, Libraries}
library(tidyverse)
library(here)
library(leaflet)
library(lubridate)
library(devtools)
library(kableExtra)
library(memer)
library(maps)
library(mapproj)
library(mapdata)
library(sp)
library(rgeos)
library(readr)
```


# Read in Data
```{r, read in data}
feederwatch <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-01-10/PFW_2021_public.csv')

site_data <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-01-10/PFW_count_site_data_public_2021.csv')

SpeciesCode <- read_csv(here("fajardo","data","SpeciesCode.csv"))
```

# Cites used
https://rstudio.github.io/leaflet/map_widget.html

# Basic leaflet commands to learn
```{r, Practice}
m <- leaflet() %>% #step 1. Create a map widget by calling leaflet()
  addTiles() %>%  # Add default OpenStreetMap map tiles, step 2. Add layers (i.e., features) to the map by using layer functions (e.g. addTiles, addMarkers, addPolygons) to modify the map widget
  addMarkers(lng=174.768, lat=-36.852, popup="The birthplace of R") # Repeat step 2 as desired, mst use long and lat
m  # Print the map

# add some circles to a map
df = data.frame(Lat = 1:10, Long = rnorm(10))
leaflet(df) %>% addCircles() # this didn't make anything

leaflet(df) %>% addCircles(lng = ~Long, lat = ~Lat) #This didn't make sense
```


```{r, SP}
Sr1 = Polygon(cbind(c(2, 4, 4, 1, 2), c(2, 3, 5, 4, 2)))
Sr2 = Polygon(cbind(c(5, 4, 2, 5), c(2, 3, 2, 2)))
Sr3 = Polygon(cbind(c(4, 4, 5, 10, 4), c(5, 3, 2, 5, 5)))
Sr4 = Polygon(cbind(c(5, 6, 6, 5, 5), c(4, 4, 3, 3, 4)), hole = TRUE)
Srs1 = Polygons(list(Sr1), "s1")
Srs2 = Polygons(list(Sr2), "s2")
Srs3 = Polygons(list(Sr4, Sr3), "s3/4")
SpP = SpatialPolygons(list(Srs1, Srs2, Srs3), 1:3)
leaflet(height = "300px") %>% addPolygons(data = SpP) # this made a cool polygon with not map but you can zzom in and out

```


# Practice with maps
```{r}
mapStates = map("state", fill = TRUE, plot = FALSE)
leaflet(data = mapStates) %>% addTiles() %>% # uses data to map the US but used a map of North America
  addPolygons(fillColor = topo.colors(10, alpha = NULL), stroke = FALSE) # makes shapes of states
```

# The Formula Interface
The arguments of all layer functions can take normal R objects, such as a numeric vector for the lat argument, or a character vector of colors for the color argument. They can also take a one-sided formula, in which case the formula will be evaluated using the data argument as the environment. For example, ~ x means the variable x in the data object, and you can write arbitrary expressions on the right-hand side, e.g., ~ sqrt(x + 1)
```{r}
m = leaflet() %>% addTiles()
df = data.frame(
  lat = rnorm(100),
  lng = rnorm(100),
  size = runif(100, 5, 20),
  color = sample(colors(), 100)
)
m = leaflet(df) %>% addTiles()
m %>% addCircleMarkers(radius = ~size, color = ~color, fill = FALSE)
m %>% addCircleMarkers(radius = runif(100, 4, 10), color = c('red'))
```

# Using Basemaps
Leaflet supports basemaps using map tiles, popularized by Google Maps and now used by nearly all interactive web maps.The easiest way to add tiles is by calling addTiles() with no arguments; by default, OpenStreetMap tiles are used.
```{r, Base Maps}
n <- leaflet() %>% setView(lng = -71.0589, lat = 42.3601, zoom = 12) #setView argument requires a long and lat with a zoom setting
n %>% addTiles() # this ads OpenStreetMap tile from google
```

# Adding tiles 
There are a ton of tiles you can use as your base maps. type in name(providers) to look all of the tiles up
```{r}
m %>% addProviderTiles(providers$OpenWeatherMap.Snow) # alot of them look the same though

m %>% addProviderTiles(providers$Stamen.Toner)

m %>% addProviderTiles(providers$Esri.NatGeoWorldMap)
```

# Markers
## Icon Markers
Icon markers are added using the addMarkers or the addAwesomeMarkers functions. Their default appearance is a dropped pin. As with most layer functions, the popup argument can be used to add a message to be displayed on click, and the label option can be used to display a text label either on hover or statically.
```{r}
data(quakes)
# Show first 20 rows from the `quakes` dataset
leaflet(data = quakes[1:20,]) %>% addTiles() %>%
  addMarkers(~long, ~lat, popup = ~as.character(mag), label = ~as.character(mag))
```

# Data Wrangling
```{r}
feed_site <- full_join(feederwatch, site_data)
birds_joined <- full_join(feed_site, SpeciesCode) %>% 
  select(loc_id, latitude, longitude, subnational1_code, Month, Day, Year, species_code, how_many, sci_name, order, family)
birds_joined$date <- paste(birds_joined$Month, birds_joined$Day, birds_joined$Year, sep = "/")
```

# Working with data and leaflet
```{r}
leaflet(birds_joined) %>% addTiles() %>% addMarkers(
  clusterOptions = markerClusterOptions(),
    clusterId = "birdsCluster",
  label = ~sci_name) %>%
  addEasyButton(easyButton(
    states = list(
      easyButtonState(
        stateName="unfrozen-markers",
        icon="ion-toggle",
        title="Freeze Clusters",
        onClick = JS("
          function(btn, map) {
            var clusterManager =
              map.layerManager.getLayer('cluster', 'birdsCluster');
            clusterManager.freezeAtZoom();
            btn.state('frozen-markers');
          }")
      ),
      easyButtonState(
        stateName="frozen-markers",
        icon="ion-toggle-filled",
        title="UnFreeze Clusters",
        onClick = JS("
          function(btn, map) {
            var clusterManager =
              map.layerManager.getLayer('cluster', 'birdsCluster');
            clusterManager.unfreeze();
            btn.state('unfrozen-markers');
          }")
      )
    )
  ))
```

